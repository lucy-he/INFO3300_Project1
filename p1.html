<html>
<head>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="js/jquery-1.12.1.min.js"></script>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/bootstrap-theme.min.css">
<script src="js/bootstrap.min.js"></script>
<style>
text{
  font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;

}
path, axis {
  stroke-width:.2px;
}
path.domain{
  fill:none;
  shape-rendering:crispedges;
  stroke:black;
  stroke-width:2px;
}
p{
  font-size:18px;
}
</style>
</head>
<body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Analysis into High Milk Production, Low Milk Consumption in China</a>
        </div>
    

      </div>
    </nav>
    <br><br>

    <div class="jumbotron">
      <div class="container">
          <div class="row">
            <div class="col-md-10">

              <h1>Got Milk?</h1>
              <p>China is now the third largest producer of milk in the world by weight. Yet, very few of its citizens drink the milk produced in the country. What's the reason for this disparity in milk production and consumption in that country? If a drink makes a significant portion of the population physically ill, should a country keep producing it?</p>
          </div>

        <div class="col-md-2">
          <img src="cow8.png" height="220" width="150">
        </div>
       </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-12">
        <h3>A Disparity in Total Milk Production vs. Consumption</h3>
        <p>This split bar graph depicts the disparity between worldwide total milk production in white and consumption in black across twenty different countries in 2011. We chose to display consumption in tonnes/capita to show that one person in Chinese consumes much less milk compared to one person in the other milk producing countries. Milk production is displayed in tonnes to show that China is the third largest milk producer.  </p>
        <blockquote>Interestingly, China produces over 400 billion kg of milk  (behind the US and India), but so few of its population consume milk. </blockquote>
        <svg id="barlabels" width="100%" height="1000">
        <svg id="milk" width="100%" height="3300">
        <svg id="bars" width="100%" height="1000">

          </svg>
         
        </svg>
        

<script>
    var leftPadding = 50;
    var topPadding = 200;
    var milk=[{"x":91,"y":40},
          {"x":112,"y":40},
          {"x":112,"y":48},
          {"x":126,"y":70},
          {"x":126,"y":148},
          {"x":77,"y":148},
          {"x": 77,"y":70},
          {"x":91,"y":48},
          {"x":91,"y":40},
          {"x":112,"y":40}];
    var indialeft=[{"x":-8,"y":32},{"x":70,"y":32}];
    var indiaright=[{"x":130,"y":32},{"x":212,"y":32}];

    var usleft=[{"x":-9,"y":58},{"x":-4,"y":58}];
    var usright=[{"x":207,"y":58},{"x":214,"y":58}];

    var chinaleft=[{"x":-14,"y":86},{"x":70,"y":86}];
    var chinaright=[{"x":130,"y":86},{"x":215,"y":86}];

    var pakleft=[{"x":-15,"y":112},{"x":63,"y":112}];
    var pakright=[{"x":138,"y":112},{"x":218,"y":112}];

    var brazilleft=[{"x":-16,"y":138},{"x":68,"y":138}];
    var brazilright=[{"x":125,"y":138},{"x":219,"y":138}];

    var russialeft=[{"x":-19,"y":164},{"x":68,"y":164}];
    var russiaright=[{"x":130,"y":164},{"x":222,"y":164}];

    var gerleft=[{"x":-20,"y":190},{"x":60,"y":190}];
    var gerright=[{"x":140,"y":190},{"x":224,"y":190}];

    var franceleft=[{"x":-22,"y":216},{"x":70,"y":216}];
    var franceright=[{"x":130,"y":216},{"x":225,"y":216}];

    var turleft=[{"x":-22,"y":242},{"x":60,"y":242}];
    var turright=[{"x":140,"y":242},{"x":225,"y":242}];

    var ukleft=[{"x":-24,"y":268},{"x":30,"y":268}];
    var ukright=[{"x":170,"y":268},{"x":227,"y":268}];

    var polandleft=[{"x":-24,"y":294},{"x":60,"y":294}];
    var polandright=[{"x":140,"y":294},{"x":227,"y":294}];

    var argleft=[{"x":-24,"y":320},{"x":45,"y":320}];
    var argright=[{"x":150,"y":320},{"x":230,"y":320}];

    var mexleft=[{"x":-25,"y":346},{"x":55,"y":346}];
    var mexright=[{"x":145,"y":346},{"x":230,"y":346}];

    var ausleft=[{"x":-26,"y":372},{"x":62,"y":372}];
    var ausright=[{"x":140,"y":372},{"x":228,"y":372}];

    var canadaleft=[{"x":-26,"y":398},{"x":62,"y":398}];
    var canadaright=[{"x":138,"y":398},{"x":228,"y":398}];

    var spainleft=[{"x":-25,"y":424},{"x":67,"y":424}];
    var spainright=[{"x":130,"y":424},{"x":228,"y":424}];

    var sudanleft=[{"x":-24,"y":450},{"x":70,"y":450}];
    var sudanright=[{"x":127,"y":450},{"x":228,"y":450}];

    var jpleft=[{"x":-21,"y":476},{"x":65,"y":476}];
    var jpright=[{"x":130,"y":476},{"x":225,"y":476}];

    var iranleft=[{"x":-17,"y":502},{"x":70,"y":502}];
    var iranright=[{"x":130,"y":502},{"x":220,"y":502}];

    var uzleft=[{"x":-10,"y":528},{"x":50,"y":528}];
    var uzright=[{"x":145,"y":528},{"x":214,"y":528}];

    var svgContainer = d3.select("#bars");
    var svglabels=d3.select("#barlabels");

    var lineFunction = d3.svg.line().x(function(d){return d.x;})
             .y(function(d){return d.y;}).interpolate("cardinal");
  
    function histogram(bins) {
      var height = svgContainer.attr("height");
      var width = svgContainer.attr("width");
      var XScale = d3.scale.linear()
                                .domain([170, 0])
                                .range([0, 430])
                            
      var xAxis = d3.svg.axis()
                        .scale(XScale).ticks(5)
                      
      var xAxisGroup = svgContainer.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0, 774)")
                                   .call(xAxis);
     svgContainer.append("g").attr("class","ylabel").attr("transform", "translate(140," + 820 + ")").append("text").text("Total Milk Production(Tonnes)").style("font-size","15").style("font-weight","bold").call(xAxis);
      svgContainer.append("g").attr("class","ylabel").attr("transform", "translate(760," + 820 + ")").append("text").text("Total Milk Consumption (Tonnes/Capita)").style("font-size","15").style("font-weight","bold").call(xAxis);

        svgContainer.append("g").attr("class","ylabel").attr("transform", "translate(50," + 100 + ")").append("text").text("2011").style("font-size","60").style("font-weight","bold").style("opacity",".25").call(xAxis);
      var YScale1 = d3.scale.linear()
                            .domain([0,20])
                            .range([0, 520]);
      var XScale2 = d3.scale.linear()
                            .domain([0, 170])
                            .range([0, 430]);
      var xAxis2 = d3.svg.axis()
                        .scale(XScale2)
                        .ticks(5)
      var xAxisGroup2 = svgContainer.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(660, 774)")
                      .call(xAxis2);
      

     Object.keys(bins).forEach(function(key) {
        svglabels.append("text").text(bins[key].countries).style("font-size","19").style("text-anchor", "middle").attr("x", 550)
        .attr("y", YScale1( bins[key].id) + 250).attr("class","countrylabel");

        svglabels.append("path").attr("d",lineFunction(indiaright)+lineFunction(indialeft)+lineFunction(usright)+lineFunction(usleft)+lineFunction(chinaright)+lineFunction(chinaleft)+lineFunction(pakleft)+lineFunction(pakright)+lineFunction(brazilleft)+lineFunction(brazilright)+lineFunction(russiaright)+lineFunction(russialeft)+lineFunction(franceright)+lineFunction(franceleft)+lineFunction(gerright)+lineFunction(gerleft)+lineFunction(turleft)+lineFunction(turright)+lineFunction(ukleft)+lineFunction(ukright)+lineFunction(polandleft)+lineFunction(polandright)+lineFunction(argright)+lineFunction(argleft)+lineFunction(mexleft)+lineFunction(mexright)+lineFunction(ausleft)+lineFunction(ausright)+lineFunction(canadaleft)+lineFunction(canadaright)+lineFunction(spainleft)+lineFunction(spainright)+lineFunction(sudanleft)+lineFunction(sudanright)+lineFunction(jpleft)+lineFunction(jpright)+lineFunction(iranleft)+lineFunction(iranright)+lineFunction(uzright)+lineFunction(uzleft)).attr("stroke","black").attr("stroke-width",1).attr("transform","translate(450,238)");


        svgContainer.append("rect").attr("class", "bar").style("fill","white").style("stroke","black")
        .attr("x", XScale(bins[key].Production / 1000000) - 26)
        .attr("y", YScale1( bins[key].id) + 230)
        .attr("width", XScale( 150 - (bins[key].Production / 1000000)))
        .attr("height", 23)
      });
      Object.keys(bins).forEach(function(key) {
        svgContainer.append("rect").attr("class", "bar").style("fill","#2C2B2A").style("stroke","black")
        .attr("x", 660)
        .attr("y", YScale1( bins[key].id) + 230)
        .attr("width", XScale2(bins[key].Total_Milk_Consumption/1000000))
        .attr("height", 23)
      });
    };
    d3.json("json/all_data.json",function(error,countries){
      if(error){
        console.log("error");
      }
      var bins=countries;
      histogram(bins);
    })
    var grad = d3.select("#milk").append("defs").append("linearGradient").attr("id", "grad").attr("x1", "0%").attr("x2", "0%").attr("y1", "100%").attr("y2", "0%");
    grad.append("stop").attr("offset", "80%").style("stop-color", "#FDF5E6").append("path");
    grad.append("stop").attr("offset", "80%").style("stop-color", "white");
    var milkimg=d3.select("#milk").append("path").attr("d",lineFunction(milk)).attr("stroke","black").attr("stroke-width",1).attr("fill","url(#grad)").attr("transform","scale(4.5,6.3),translate(21,-26)");

    
    </script>
</div>
</div>
     <div class="row">
        <div id="graph2"class="col-md-12">
        <h3>Scatterplot Lactose intolerance (in %) vs. Consumption (thousand tonnes/capita/year)</h3>

<script>
    var margin = {top: 20, right: 20, bottom: 35, left: 100},
    width = 1000 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom;
    var xScale = d3.scale.linear().domain([0, 300]).range([0, width]);
    var yScale = d3.scale.linear().domain([0, 100]).range([height, 0]);
    var color = d3.scale.category20();
    var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom");
    var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left");
    var svg2 = d3.selectAll("#graph2").append("svg")
      .attr("width", width + margin.left + margin.right + 500)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + (margin.left) + "," + margin.top + ")");    
    //Get json data from scatter_plot data
    d3.json("json/all_data.json", function (error,countries) {
      var data = countries;
      data.forEach(function (d) {
        // body...
        //Creating an array
        d.Lactose_intolerance_percent= +d.Lactose_intolerance_percent;
        d.Consumption = +(d.Consumption);
        console.log ("d.Consumption = " + (+(d.Consumption)) );
        console.log ("d.Lactose_intolerance_percent = " + (+d.Lactose_intolerance_percent) );
      });
      //Returns the minimum and maximum value in the given array using natural order
      // var xScale = d3.scale.linear().domain([0, 45]).range([0, width]);
      // var yScale = d3.scale.linear().domain([0, 625]).range([height, 0]);
      //console.log("I have reached this point");
      var countriesCon = data.sort(function(a,b){return a.Consumption - b.Consumption})
      svg2.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
      .append("text")
        .attr("class", "label")
        .attr("x", width)
        .attr("y", 30)
        .style("text-anchor", "end")
        .text("Consumption (in thousand tonnes/capita/year)");
      svg2.append("g")
        .attr("class", "y axis")
        .call(yAxis)
      .append("text")
        .attr("class", "label")
        .attr("transform", "rotate(-90)")
        .attr("y", -50)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Population of Lactose Intolerant by Country (in %)");
      //console.log("AXIS looks fine");
      svg2.selectAll(".dot")
        .data(countriesCon)
      .enter().append("circle")
        .attr("class", "dot")
        .attr("r", 7)
        .attr("cx", function(d) { 
         // console.log("xScale(d.Consumption / 100: " + xScale(d.Consumption));
          return xScale(d.Consumption); 
        })
        .attr("cy", function(d) { 
         // console.log("yScale(d.lactIntol_population) " + yScale(d.Lactose_intolerance_percent));
          return yScale(d.Lactose_intolerance_percent); 
        })
        .style("fill", function(d) { return color(d.countries); });
      console.log("Data points look funny");
      var colorScale = d3.scale.linear().domain([31.5, 256.8]).range([0, 400]);
      var colorAxis = d3.svg.axis()
                      .scale(colorScale)
                      .orient("right")
                      .tickValues([31.5, 256.8]);
      svg2.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(950, 0)")
                .call(colorAxis)
      var legend = svg2.selectAll(".legend")
        .data(color.domain())
      .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function(countriesCon, i) { 
          return "translate(0," + i * 20 + ")"; 
        });
      legend.append("rect")
        .attr("x", width + 40)
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", color);
      legend.append("text")
        .attr("x", width + 30)
        .attr("y", 9)
        .attr("dy", ".35em")
        .style("text-anchor", "end")
        .text(function(d) { return d; });
      svg2.append("text")
        .attr("class", "label")
        .attr("transform", "translate(940, 360) rotate(90)")
        .attr("y", -50)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("ranking of countries by milk consumption in tonnes/capita");
    
    });
</script>

        </div>
    </div>
       <div class="row">
        <div id="graph3" class="col-md-12">
        <h3>Scatterplot Lactose intolerance (in %) vs. Consumption (thousand tonnes/capita/year)</h3>

<script>
    var margin = {top: 20, right: 20, bottom: 90, left: 100},
    width = 1000 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom;
    //Range rounf bands and rangeRound, consieres for padding around each, typically [0,1]
    var xScale = d3.scale.ordinal().rangeRoundBands([0, width], .1);
    var yScale = d3.scale.linear().rangeRound([height, 0]);
    var color = d3.scale.ordinal()
    .range(["#98abc5", "#ff8c00", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
    var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom");
    var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left")
    .tickFormat(d3.format(".2s"));
    var svg3 = d3.select("#graph3").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + (margin.left) + "," + margin.top + ")");    
    //Get json data from scatter_plot data
    d3.json("json/all_data.json", function (error,countries) {
      if(error){
        throw error;
        console.log("ERROR: unable to retrieve data!")
      }
      console.log("I read data points.");
      var data = countries;
      console.log(data);
      //Filter out 'countries' filed from data to be considered on x-axis 
      console.log(data[0]);
      color.domain(d3.keys(data[0]).filter(function(key) { return (key !== "id"  
                      && key !== "countries" 
                      && key !== "Population"
                      && key !== "Lactose_intolerance_percent"
                      && key !== "lactIntol_population" 
                      && key !== "Production" 
                      && key !== "Consumption" 
                      && key !== "Total_Milk_Consumption" 
                      && key !== "Total_Animal_Count"
                      ); 
      }));
      data.forEach(function(d) {
          var y0 = 0;
          d.livestock = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
          //d.total is redundant since this is is the same as entity 'Total_Animal_Count'
          d.total = d.livestock[d.livestock.length - 1].y1;
          console.log("livestock in d3.json: " + d.livestock);
          console.log("total in d3.json: " + d.total);
        });
      //console.log(data);
      //Sort in ascending order of livestock numbers
      //console.log(data.sort(function(a, b) { return b.total - a.total; }));
      data.sort(function(a, b) { return b.total - a.total; })
      //Set domain for x and y axis
      xScale.domain(data.map(function(d) { return d.countries; }));
      yScale.domain([0, d3.max(data, function(d) { return d.total; })]);
      //Rotate the axis labels
      svg3.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
      .selectAll('text')
        .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", "rotate(-35)" );
      svg3.append('g')
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
      .append("text")
        .attr("class", "label")
        .attr("x", width)
        .attr("y", 50)
        .style("text-anchor", "end")
        .text("Countries")
      svg3.append('g')
        .attr('class', 'y axis')
        .call(yAxis)
      .append("text")
        .attr("class", "label")
        .attr("transform", "rotate(-90)")
        .attr("y", -50)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Number of Livestock");
        // //Rotate Axis labels
        // svg.append("g")
        //   .attr("class", "x axis")
        //   .attr("class", "tick")
        //   .selectAll('text')
        //   .attr("transform", "rotate(-65)")
      //Get livestock data for each country
      var countries = svg3.selectAll(".countries")
        .data(data)
      .enter().append("g")
        .attr("class", "g")
        .attr("transform", function(d) { 
          return "translate(" + xScale(d.countries) + ",0)"; 
        });
      countries.selectAll("rect")
        .data(function(d) { 
          return d.livestock; 
        })
      .enter().append("rect")
        .attr("width", xScale.rangeBand())
        .attr("y", function(d) { 
          return yScale(d.y1); 
        })
        .attr("height", function(d) { 
          return yScale(d.y0) - yScale(d.y1); 
        })
        .style("fill", function(d) { return color(d.name); 
      });
      countries.selectAll("text")
          .attr("transform", "rotate(90)")
      var legend = svg3.selectAll(".legend")
      .data(color.domain().slice().reverse())
        .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
      legend.append("rect")
          .attr("x", width - 18)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", color);
      legend.append("text")
          .attr("x", width - 24)
          .attr("y", 9)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function(d) { return d; });
    });
</script>


        </div>

</body>
</html>